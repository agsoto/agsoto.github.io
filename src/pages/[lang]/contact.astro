---
import type { SiteMeta } from 'astro-pure/types';
import MinimalTooltip from '@/components/MinimalTooltip.astro';
import PageLayout from '@/layouts/BaseLayout.astro';
import { personalInfo } from '@/site-config';
 
export { getLangStaticPaths as getStaticPaths } from 'astro-pure/server';

const locale = (Astro.currentLocale || 'en') as keyof typeof contentMap

function formatPhone(input: string) {
  const cleaned = input.replace(/\s|\-/g, '')
  const m = cleaned.match(/^\+?(\d{1,3})(\d{10})$/)
  if (!m) return input
  const cc = m[1]
  const n = m[2]
  return `(+${cc}) ${n.slice(0, 3)} ${n.slice(3, 6)} ${n.slice(6)}`
}

const contentMap = {
  en: {
    title: 'Contact',
    headline: 'Let’s Navigate Humanity’s Mazes Together',
    copy: 'Copy',
    call: 'Call',
    whatsapp: 'WhatsApp',
    sendMail: 'Send Email'
  },
  es: {
    title: 'Contacto',
    headline: 'Naveguemos juntos los laberintos de la humanidad',
    copy: 'Copiar',
    call: 'Llamar',
    whatsapp: 'WhatsApp',
    sendMail: 'Enviar Correo'
  }
} as const
const content = contentMap[locale]
const meta: SiteMeta = {title: content.title};
---
<PageLayout meta={meta} highlightColor='#d8cbdf'>
  <div class="flex min-h-[75vh] flex-col items-center justify-center gap-6">
    <h1 class="text-center text-3xl md:text-4xl font-semibold tracking-tight">{content.headline}</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-stretch justify-center place-items-center">
    <div class="bg-[#ffffff] dark:bg-[#ffffff] border rounded-2xl shadow-sm p-8 flex h-full flex-col items-center justify-center gap-4 w-full min-h-[260px] max-w-[300px] relative z-10">
      <svg width="72" height="72" viewBox="0 0 32 32" class="mx-auto color-[#641275]">
        <use href=`/icons/bundle.svg#pixel-phone` />
      </svg>
      <p class="text-center text-xl font-medium text-primary">{formatPhone(personalInfo.phone)}</p>
      <div class="flex items-center gap-3">
        <MinimalTooltip text={content.copy}>
          <button type="button" aria-label={content.copy} class="flex h-12 w-12 items-center justify-center rounded-full border bg-background dark:bg-white text-muted-foreground transition hover:border-primary hover:text-primary shadow-sm" data-copy data-copy-value={personalInfo.phone}>
            <svg width="18" height="18" viewBox="0 0 32 32">
              <use href=`/icons/bundle.svg#copy` />
            </svg>
          </button>
        </MinimalTooltip>
        <MinimalTooltip text={content.call}>
          <button type="button" aria-label={content.call} class="flex h-12 w-12 items-center justify-center rounded-full border bg-background dark:bg-white text-muted-foreground transition hover:border-primary hover:text-primary shadow-sm" data-url={`tel:${personalInfo.phone}`}> 
            <svg width="18" height="18" viewBox="0 0 32 32">
              <use href=`/icons/bundle.svg#call` />
            </svg>
          </button>
        </MinimalTooltip>
        <MinimalTooltip text={content.whatsapp}>
          <button type="button" aria-label={content.whatsapp} class="flex h-12 w-12 items-center justify-center rounded-full border bg-background dark:bg-white text-muted-foreground transition hover:border-primary hover:text-primary shadow-sm" data-url={`https://wa.me/${personalInfo.phone}`}> 
            <svg width="18" height="18" viewBox="0 0 32 32">
              <use href=`/icons/bundle.svg#whatsapp` />
            </svg>
          </button>
        </MinimalTooltip>
      </div>
    </div>

    <div class="bg-[#ffffff] dark:bg-[#ffffff] border rounded-2xl shadow-sm p-8 flex h-full flex-col items-center justify-center gap-4 w-full min-h-[260px] max-w-[300px] relative z-10">
      <svg width="72" height="72" viewBox="0 0 32 32" class="mx-auto color-[#641275]">
        <use href=`/icons/bundle.svg#invitation` />
      </svg>
      <p id="email" class="text-center text-2xl font-medium text-primary">{personalInfo.email}</p>
      <div class="flex items-center gap-3">
        <MinimalTooltip text={content.copy}>
          <button type="button" aria-label={content.copy} class="flex h-12 w-12 items-center justify-center rounded-full border bg-background dark:bg-white text-muted-foreground transition hover:border-primary hover:text-primary shadow-sm" data-copy data-copy-selector="#email">
            <svg width="18" height="18" viewBox="0 0 32 32">
              <use href=`/icons/bundle.svg#copy` />
            </svg>
          </button>
        </MinimalTooltip>
        <MinimalTooltip text={content.sendMail}>
          <button type="button" aria-label={content.sendMail} class="flex h-12 w-12 items-center justify-center rounded-full border bg-background dark:bg-white text-muted-foreground transition hover:border-primary hover:text-primary shadow-sm" data-url={`mailto:${personalInfo.email}`}>
            <svg width="18" height="18" viewBox="0 0 32 32">
              <use href=`/icons/bundle.svg#send-mail` />
            </svg>
          </button>
        </MinimalTooltip>
      </div>
    </div>
  </div>

</PageLayout>

<script>
  import { showToast } from 'astro-pure/utils'

  const handleCopy = (target: Element) => {
    const selector = target.getAttribute('data-copy-selector')
    const value = target.getAttribute('data-copy-value')

    if (selector) {
      const el = document.querySelector(selector)
      if (!el) return
      const text = (el.textContent || '').trim()
      if (!text) return
      navigator.clipboard.writeText(text).then(() => {
        showToast({ message: `<b>${text}</b> copied / copiado!` })
      }).catch((err) => {
        console.error('Failed to copy text: ', err)
      })
      return
    }

    if (value) {
      navigator.clipboard.writeText(value).then(() => {
        showToast({ message: `<b>${value}</b> copied / copiado!` })
      }).catch((err) => {
        console.error('Failed to copy text: ', err)
      })
    }
  }

  const handleOpenUrl = (target: Element) => {
    const url = target.getAttribute('data-url')
    if (!url) return
    window.open(url, '_blank', 'noopener,noreferrer')
  }

  document.addEventListener('click', (e) => {
    const t = e.target
    if (!(t instanceof Element)) return
    const copyBtn = t.closest('[data-copy]')
    if (copyBtn) {
      e.preventDefault()
      handleCopy(copyBtn)
      return
    }

    const urlBtn = t.closest('[data-url]')
    if (urlBtn) {
      e.preventDefault()
      handleOpenUrl(urlBtn)
    }
  })
</script>
