---
import { render, type CollectionEntry } from 'astro:content'

import { getBlogCollection, sortMDByDate } from 'astro-pure/server'
import PostLayout from '@/layouts/BlogPost.astro'

export const prerender = true


export async function getStaticPaths() {
  // Define the languages you want to support
  const supportedLangs: MyBilingualLang[] = ['es', 'en'];

  // Collect posts for each language
  const allPaths = [];
  for (const lang of supportedLangs) {
    const posts = sortMDByDate(await getBlogCollection(`blog_${lang}`)) as CollectionEntry<`blog_en`>[]; // Explicit cast
    const paths = posts.map((post) => ({
      params: { id: post.id, lang },
      props: { post, posts },
    }));
    allPaths.push(...paths);
  }

  return allPaths;
}


type Props = {
  post: CollectionEntry<`blog_en`>
  posts: CollectionEntry<'blog_en'>[],
  lang: MyBilingualLang
}

const { post, posts, lang } = Astro.props
const { Content, headings, remarkPluginFrontmatter } = await render(post)
---

<PostLayout lang={lang} {post} {posts} {headings} {remarkPluginFrontmatter}>
  <Content />
</PostLayout>
